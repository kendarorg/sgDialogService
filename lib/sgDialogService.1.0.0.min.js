angular.module("sgDialogService",[]).constant("sgDialogService.version",[1,0,0]).service("sgDialogService.config",[function(){return{dialogTemplate:"sgDialogTemplate.html"}}]).controller("sgDialogServiceAlertController",["$scope","modalInstance",function(e,t){e.modalButtons=[{action:function(){t.dismiss()},text:"Ok","class":"btn-primary"}]}]).controller("sgDialogServiceConfirmController",["$scope","modalInstance",function(e,t){e.cancelConfirm=function(){t.closeModal(!1)},e.modalButtons=[{action:function(){t.closeModal(!1)},text:"Cancel","class":"btn-default"},{action:function(){t.closeModal(!0)},text:"Ok","class":"btn-primary"}]}]).service("sgDialogService",["$http","$templateCache","$controller","$compile","$rootScope","$document","sgDialogService.config",function(e,t,o,l,a,n,i){var c=i.dialogTemplate,r="",d=[],s=function(e){if(d.length>0){var t="dialog"+d.length,o=d[d.length-1],n="<div class='modalHiddenOverlay modalOverlay' id='"+t+"' name='"+t+"' style='width:"+o.width+"px;'></div>";o.dialog[0].appendChild(l(n)(a)[0])}d.push(e)},m=function(){var e=d[d.length-1];if(1==d.length&&e.overlay.toggleClass("modalHidden"),d.length>1){var t="dialog"+(d.length-1),o=document.getElementById(t),l=o.parentElement;l.removeChild(o)}d.pop(),e.dialog.remove()};e.get(c,{cache:t}).then(function(e){r=e.data});var p=document.getElementById("modalDialogOverlay");if(!p){var u="<div id='modalDialogOverlay' name='modalDialogOverlay' class='modalDialogOverlay modalHidden modalOverlay'></div>";document.body.appendChild(l(u)(a)[0])}this.alert=function(e,t){t||(t="Alert:"),this.openModal({data:{title:t},template:"<span ng-controller='sgDialogServiceAlertController'>"+e+"</span>"})},this.confirm=function(e,t,o){o||(o="Confirm:"),this.openModal({data:{title:o},template:"<span ng-controller='sgDialogServiceConfirmController'>"+e+"</span>",callback:t,closeModal:"cancelConfirm"})};var g=function(e,t,i){var c=!1;if(!t.controller){var p=e.match(/ng-controller(\s\S)*=(\s\S)*("|')([^"']*)("|')/im);null!=p&&(t.controller=p[4],e=e.replace(p[0],""),c=!0)}if(!t.templateUrl&&!t.template)throw"Must specify at least a template or a template Url!";if(f(t),templateScope=t.scope,t.scope){if(t.controller)throw c?"Unable to use parent scope for openModal if a controller is specified on view: '"+t.templateUrl+"'":"Unable to use parent scope for openModal if a controller is specified in the call"}else templateScope=a.$new();if(i.dismiss=function(){m()},i.closeModal=function(e){t.callback&&t.callback(e),m()},templateScope[t.closeModal]=i.closeModal,i.scope=templateScope,i.width=t.width,!t.scope)for(var u in t.data)templateScope[u]=t.data[u];t.controller&&(templateScope.dialogWidth=t.width,o(t.controller,{$scope:templateScope,modalInstance:i}));var g=r.replace("#modalTitle#","{{"+t.title+"}}");g=g.replace("button in modalButtons","button in "+t.modalButtons),g=g.replace("#closeModal#",t.closeModal+"()"),g=g.replace("#modalBody#",e),templateScope.dialogWidth=t.width;var y=l(g)(templateScope);document.body.appendChild(y[0]),0==d.length&&i.overlay.toggleClass("modalHidden"),i.dialog=angular.element(y),M(i,t.width);var S=angular.element(y[0].getElementsByClassName("modal-header"));S.bind("mousedown",function(e){return i.startX=i.dialog.prop("offsetLeft"),i.startY=i.dialog.prop("offsetTop"),i.initialMouseX=e.clientX,i.initialMouseY=e.clientY,i.mouseMove=function(e){return h(e,i)},i.mouseup=function(){return v(i)},n.bind("mousemove",i.mouseMove),n.bind("mouseup",i.mouseup),!1}),s(i)};this.openModal=function(o){var l={overlay:angular.element(document.getElementById("modalDialogOverlay")),startX:-1,startY:-1,initialMouseX:-1,initialMouseY:-1};return o.templateUrl?e.get(o.templateUrl,{cache:t}).then(function(e){g(e.data,o,l)}):g(o.template,o,l),l};var f=function(e){e.data||(e.data={}),e.title||(e.title="title"),e.modalButtons||(e.modalButtons="modalButtons"),e.closeModal||(e.closeModal="closeModal"),e.width||(e.width=800)},h=function(e,t){var o=t.startX+(e.clientX-t.initialMouseX),l=t.startY+(e.clientY-t.initialMouseY),a={top:l+"px",left:o+"px"};return t.dialog.css(a),!1},v=function(e){n.unbind("mousemove",e.mousemove),n.unbind("mouseup",e.mouseup)},M=function(e,t){{var o=Math.max(document.documentElement.clientWidth,window.innerWidth||0);Math.max(document.documentElement.clientHeight,window.innerHeight||0)}posWidth=o/2-t/2;var l=10*d.length;posHeight=17+l,posWidth+=l,e.dialog.css({position:"fixed",left:posWidth+"px",top:posHeight+"px"})}}]);