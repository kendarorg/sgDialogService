angular.module("sgDialogService",[]).constant("sgDialogService.version",[1,0,1]).service("sgDialogService.config",[function(){return{dialogTemplate:"sgDialogTemplate.html"}}]).controller("sgDialogServiceAlertController",["$scope","modalInstance",function(e,o){e.modalButtons=[{action:function(){o.dismiss()},text:"Ok","class":"btn-primary"}]}]).controller("sgDialogServiceConfirmController",["$scope","modalInstance",function(e,o){e.cancelConfirm=function(){o.closeModal(!1)},e.modalButtons=[{action:function(){o.closeModal(!1)},text:"Cancel","class":"btn-default"},{action:function(){o.closeModal(!0)},text:"Ok","class":"btn-primary"}]}]).service("sgDialogService",["$http","$templateCache","$controller","$compile","$rootScope","$document","sgDialogService.config",function(e,o,t,l,a,n,i){var r=i.dialogTemplate,c="",s=[],d=function(e){if(s.length>0){var o="dialog"+s.length,t=s[s.length-1],n="<div class='modalHiddenOverlay modalOverlay' id='"+o+"' name='"+o+"'></div>";t.dialog[0].appendChild(l(n)(a)[0])}s.push(e)},m=function(){var e=s[s.length-1];if(1==s.length&&e.overlay.toggleClass("modalHidden"),s.length>1){var o="dialog"+(s.length-1),t=document.getElementById(o),l=t.parentElement;l.removeChild(t)}s.pop(),e.dialog.remove()};e.get(r,{cache:o}).then(function(e){c=e.data});var p=document.getElementById("modalDialogOverlay");if(!p){var u="<div id='modalDialogOverlay' name='modalDialogOverlay' class='modalDialogOverlay modalHidden modalOverlay'></div>";document.body.appendChild(l(u)(a)[0])}this.alert=function(e,o){o||(o="Alert:"),this.openModal({data:{title:o},template:"<span ng-controller='sgDialogServiceAlertController'>"+e+"</span>"})},this.confirm=function(e,o,t){t||(t="Confirm:"),this.openModal({data:{title:t},template:"<span ng-controller='sgDialogServiceConfirmController'>"+e+"</span>",callback:o,closeModal:"cancelConfirm"})};var g=function(e,o,i){var r=!1;if(!o.controller){var p=e.match(/ng-controller(\s\S)*=(\s\S)*("|')([^"']*)("|')/im);null!=p&&(o.controller=p[4],e=e.replace(p[0],""),r=!0)}if(!o.templateUrl&&!o.template)throw"Must specify at least a template or a template Url!";if(f(o),templateScope=o.scope,o.scope){if(o.controller)throw r?"Unable to use parent scope for openModal if a controller is specified on view: '"+o.templateUrl+"'":"Unable to use parent scope for openModal if a controller is specified in the call"}else templateScope=a.$new();if(i.dismiss=function(){m()},i.closeModal=function(e){o.callback&&o.callback(e),m()},templateScope[o.closeModal]=i.closeModal,i.scope=templateScope,!o.scope)for(var u in o.data)templateScope[u]=o.data[u];o.controller&&t(o.controller,{$scope:templateScope,modalInstance:i});var g=c.replace("#modalTitle#","{{"+o.title+"}}");g=g.replace("button in modalButtons","button in "+o.modalButtons),g=g.replace("#closeModal#",o.closeModal+"()"),g=g.replace("#modalBody#",e);var y=l(g)(templateScope);document.body.appendChild(y[0]),0==s.length&&i.overlay.toggleClass("modalHidden"),i.dialog=angular.element(y),M(i,o.width);var S=angular.element(y[0].getElementsByClassName("modal-header"));S.bind("mousedown",function(e){return i.startX=i.dialog.prop("offsetLeft"),i.startY=i.dialog.prop("offsetTop"),i.initialMouseX=e.clientX,i.initialMouseY=e.clientY,i.mouseMove=function(e){return v(e,i)},i.mouseup=function(){return h(i)},n.bind("mousemove",i.mouseMove),n.bind("mouseup",i.mouseup),!1}),d(i)};this.openModal=function(t){var l={overlay:angular.element(document.getElementById("modalDialogOverlay")),startX:-1,startY:-1,initialMouseX:-1,initialMouseY:-1};return t.templateUrl?e.get(t.templateUrl,{cache:o}).then(function(e){g(e.data,t,l)}):g(t.template,t,l),l};var f=function(e){e.data||(e.data={}),e.title||(e.title="title"),e.modalButtons||(e.modalButtons="modalButtons"),e.closeModal||(e.closeModal="closeModal")},v=function(e,o){var t=o.startX+(e.clientX-o.initialMouseX),l=o.startY+(e.clientY-o.initialMouseY),a={top:l+"px",left:t+"px"};return o.dialog.css(a),!1},h=function(e){n.unbind("mousemove",e.mousemove),n.unbind("mouseup",e.mouseup)},M=function(e,o){var t=Math.max(document.documentElement.clientWidth,window.innerWidth||0),l=(Math.max(document.documentElement.clientHeight,window.innerHeight||0),e.dialog.prop("offsetWidth"));o&&(l=o),posWidth=t/2-l/2;var a=10*s.length;posHeight=17+a,posWidth+=a;var n={position:"fixed",left:posWidth+"px",top:posHeight+"px"};o&&(n.width=o+"px"),e.width=o,e.dialog.css(n)}}]);